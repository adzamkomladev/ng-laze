function _classCallCheck(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,n){for(var t=0;t<n.length;t++){var r=n[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass(e,n,t){return n&&_defineProperties(e.prototype,n),t&&_defineProperties(e,t),e}(window.webpackJsonp=window.webpackJsonp||[]).push([[25],{DwnV:function(e,n,t){"use strict";t.r(n),t.d(n,"ProjectsModule",(function(){return ee}));var r,i=t("ofXK"),o=t("tyNb"),c=t("3Pt+"),a=t("FwiY"),l=t("jPNr"),s=t("OzZK"),b=t("dEAy"),u=t("ocnv"),p=t("0lU3"),f=t("D9mS"),d=t("PTRe"),z=t("Wfee"),g=t("JA5x"),m=t("ZyQt"),h=t("ZE2D"),j=t("nJia"),v=t("3/1E"),y=t("jV0o"),C=t("fXoL"),T=((r=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"setFormValue",value:function(e){var n;this.formValue=Object.assign(Object.assign({},e),{file:null===(n=this.formValue)||void 0===n?void 0:n.file})}},{key:"addFile",value:function(e){this.formValue.file=e}},{key:"getFormValue",value:function(){return Object.assign({},this.formValue)}},{key:"setFormValidity",value:function(e){this.formValidity=e}},{key:"getFormValidity",value:function(){return this.formValidity}}]),e}()).\u0275fac=function(e){return new(e||r)},r.\u0275prov=C.Ob({token:r,factory:r.\u0275fac}),r),F=t("ML9l"),X=t("TzFQ"),k=t("bOdf"),S=t("vkgz"),P=t("3E0/"),Y=t("JIr8"),w=t("AytR"),O=t("Ihmt"),I=t("B+r4"),V=t("RwU8"),M=t("C2AL");function q(e,n){if(1&e){var t=C.Zb();C.Yb(0,"button",13),C.gc("click",(function(){return C.zc(t),C.jc().onProjectAction("EDIT")})),C.Tb(1,"i",14),C.Hc(2,"Edit "),C.Xb()}}var x,A=((x=function(){function e(){_classCallCheck(this,e),this.projectAction=new C.n}return _createClass(e,[{key:"onProjectAction",value:function(e){this.projectAction.emit(e)}},{key:"canEdit",get:function(){var e;return this.project.ownerId===this.currentUser.id||(null===(e=this.project)||void 0===e?void 0:e.assigneeId)===this.currentUser.id||"ADMIN"===this.currentUser.role}}]),e}()).\u0275fac=function(e){return new(e||x)},x.\u0275cmp=C.Mb({type:x,selectors:[["laze-project-card"]],inputs:{project:"project",currentUser:"currentUser"},outputs:{projectAction:"projectAction"},decls:32,vars:14,consts:[["nz-row","","nzJustify","space-between"],["nz-col",""],["nzTooltipTitle","Project deadline","nzTooltipPlacement","bottom","nz-tooltip",""],["nz-icon","","nzType","hourglass","nzTheme","outline"],["nzTooltipTitle","Project creation","nzTooltipPlacement","bottom","nz-tooltip",""],["nz-icon","","nzType","calendar"],["typography","",1,"price"],[1,"owner-info"],["nzText","U",3,"nzSrc"],["nzColor","#337357"],["nz-button","","nzType","primary",3,"click"],["nz-icon","","nzType","eye"],["nz-button","","nzType","default",3,"click",4,"ngIf"],["nz-button","","nzType","default",3,"click"],["nz-icon","","nzType","edit"]],template:function(e,n){1&e&&(C.Yb(0,"nz-card"),C.Yb(1,"div",0),C.Yb(2,"div",1),C.Yb(3,"h3"),C.Hc(4),C.Xb(),C.Yb(5,"p",2),C.Tb(6,"i",3),C.Hc(7),C.kc(8,"date"),C.Xb(),C.Yb(9,"p",4),C.Tb(10,"i",5),C.Hc(11),C.kc(12,"date"),C.Xb(),C.Xb(),C.Yb(13,"div",1),C.Yb(14,"p",6),C.Yb(15,"strong"),C.Hc(16),C.Xb(),C.Xb(),C.Yb(17,"div",7),C.Tb(18,"nz-avatar",8),C.Yb(19,"p"),C.Hc(20),C.Xb(),C.Xb(),C.Xb(),C.Xb(),C.Tb(21,"hr"),C.Yb(22,"div",0),C.Yb(23,"div",1),C.Yb(24,"nz-tag",9),C.Hc(25),C.kc(26,"titlecase"),C.Xb(),C.Xb(),C.Yb(27,"div",1),C.Yb(28,"button",10),C.gc("click",(function(){return n.onProjectAction("VIEW")})),C.Tb(29,"i",11),C.Hc(30,"View "),C.Xb(),C.Fc(31,q,3,0,"button",12),C.Xb(),C.Xb(),C.Xb()),2&e&&(C.Cb(4),C.Ic(n.project.title),C.Cb(3),C.Jc(" ",C.lc(8,8,n.project.deadline)," "),C.Cb(4),C.Jc(" ",C.lc(12,10,null==n.project?null:n.project.createdAt)," "),C.Cb(5),C.Ic((null==n.project?null:n.project.price)||"N/A"),C.Cb(2),C.qc("nzSrc",null==n.project.owner?null:n.project.owner.profileImageUrl),C.Cb(2),C.Ic(n.project.owner.username),C.Cb(5),C.Ic(C.lc(26,12,n.project.status)),C.Cb(6),C.qc("ngIf",n.canEdit))},directives:[g.a,I.c,I.a,j.b,a.a,M.a,h.a,m.a,s.a,V.a,i.m],pipes:[i.e,i.v],styles:["nz-card[_ngcontent-%COMP%]{box-shadow:0 2px 2px #bababa}.price[_ngcontent-%COMP%]{text-align:right}.owner-info[_ngcontent-%COMP%]{text-align:left}button[_ngcontent-%COMP%]{margin-right:12px}"]}),x);function L(e,n){1&e&&(C.Wb(0),C.Hc(1," Please input project title! "),C.Vb())}function U(e,n){1&e&&(C.Wb(0),C.Hc(1," Project title must be less than 255 characters! "),C.Vb())}function _(e,n){if(1&e&&(C.Fc(0,L,2,0,"ng-container",17),C.Fc(1,U,2,0,"ng-container",17)),2&e){var t=n.$implicit;C.qc("ngIf",t.hasError("required")),C.Cb(1),C.qc("ngIf",t.hasError("maxlength"))}}function E(e,n){1&e&&(C.Wb(0),C.Hc(1," Please input project details! "),C.Vb())}function H(e,n){1&e&&C.Fc(0,E,2,0,"ng-container",17),2&e&&C.qc("ngIf",n.$implicit.hasError("required"))}function D(e,n){1&e&&(C.Wb(0),C.Hc(1," Please input your deadline! "),C.Vb())}function N(e,n){1&e&&C.Fc(0,D,2,0,"ng-container",17),2&e&&C.qc("ngIf",n.$implicit.hasError("required"))}var J,W=((J=function(){function e(n,t){var r=this;_classCallCheck(this,e),this.fb=n,this.projectFormService=t,this.beforeUpload=function(e){return r.fileList=r.fileList.concat(e),r.projectFormService.addFile(e),!1},this.fileList=[]}return _createClass(e,[{key:"ngOnInit",value:function(){this.initializeForm(),this.setupFormListener()}},{key:"ngOnDestroy",value:function(){this.valueChangesSubscription&&this.valueChangesSubscription.unsubscribe()}},{key:"initializeForm",value:function(){this.form=this.fb.group({title:[null,[c.o.required,c.o.maxLength(255)]],details:[null,[c.o.required]],deadline:[null,[c.o.required]]},{updateOn:"blur"})}},{key:"setupFormListener",value:function(){var e=this;this.valueChangesSubscription=this.form.valueChanges.pipe(Object(S.a)((function(n){e.projectFormService.setFormValue(n),e.projectFormService.setFormValidity(e.form.valid)}))).subscribe()}}]),e}()).\u0275fac=function(e){return new(e||J)(C.Sb(c.d),C.Sb(T))},J.\u0275cmp=C.Mb({type:J,selectors:[["laze-project-form"]],decls:35,vars:10,consts:[["nz-form","",1,"auth-form",3,"formGroup"],["nzFor","title","nz-typography","",3,"nzSpan"],["nzHasFeedback","","nzValidatingTip","Validating...",3,"nzErrorTip"],["id","title","type","text","nz-input","","nzSize","large","formControlName","title","placeholder","Project title"],["titleErrorTemplate",""],["nzFor","details","nz-typography","",3,"nzSpan"],["id","details","nz-input","","rows","4","formControlName","details","placeholder","Project details"],["detailsErrorTemplate",""],["nz-row","","nzType","flex","nzJustify","space-between"],["nz-col","","nzXs","24","nzSm","24","nzMd","11","nzLg","11","nzXl","11"],["nzFor","deadline","nz-typography","",3,"nzSpan"],["id","deadline","formControlName","deadline"],["deadlineErrorTemplate",""],["nzFor","file","nz-typography","",3,"nzSpan"],[3,"nzFileList","nzBeforeUpload","nzFileListChange"],["nz-button",""],["nz-icon","","nzType","upload"],[4,"ngIf"]],template:function(e,n){if(1&e&&(C.Yb(0,"form",0),C.Yb(1,"nz-form-item"),C.Yb(2,"nz-form-label",1),C.Yb(3,"strong"),C.Hc(4,"Title"),C.Xb(),C.Xb(),C.Yb(5,"nz-form-control",2),C.Tb(6,"input",3),C.Fc(7,_,2,2,"ng-template",null,4,C.Gc),C.Xb(),C.Xb(),C.Yb(9,"nz-form-item"),C.Yb(10,"nz-form-label",5),C.Yb(11,"strong"),C.Hc(12,"Details"),C.Xb(),C.Xb(),C.Yb(13,"nz-form-control",2),C.Tb(14,"textarea",6),C.Fc(15,H,1,1,"ng-template",null,7,C.Gc),C.Xb(),C.Xb(),C.Yb(17,"div",8),C.Yb(18,"nz-form-item",9),C.Yb(19,"nz-form-label",10),C.Yb(20,"strong"),C.Hc(21,"Deadline"),C.Xb(),C.Xb(),C.Yb(22,"nz-form-control",2),C.Tb(23,"nz-date-picker",11),C.Fc(24,N,1,1,"ng-template",null,12,C.Gc),C.Xb(),C.Xb(),C.Yb(26,"nz-form-item",9),C.Yb(27,"nz-form-label",13),C.Yb(28,"strong"),C.Hc(29,"File"),C.Xb(),C.Xb(),C.Yb(30,"nz-form-control"),C.Yb(31,"nz-upload",14),C.gc("nzFileListChange",(function(e){return n.fileList=e})),C.Yb(32,"button",15),C.Tb(33,"i",16),C.Hc(34,"Select File"),C.Xb(),C.Xb(),C.Xb(),C.Xb(),C.Xb(),C.Xb()),2&e){var t=C.yc(8),r=C.yc(16),i=C.yc(25);C.qc("formGroup",n.form),C.Cb(2),C.qc("nzSpan",24),C.Cb(3),C.qc("nzErrorTip",t),C.Cb(5),C.qc("nzSpan",24),C.Cb(3),C.qc("nzErrorTip",r),C.Cb(6),C.qc("nzSpan",24),C.Cb(3),C.qc("nzErrorTip",i),C.Cb(5),C.qc("nzSpan",24),C.Cb(4),C.qc("nzFileList",n.fileList)("nzBeforeUpload",n.beforeUpload)}},directives:[c.p,c.l,u.b,c.g,I.c,u.c,I.a,u.d,u.a,d.a,c.c,c.k,c.f,p.a,f.a,s.a,V.a,M.a,a.a,i.m],styles:[""]}),J);function Z(e,n){if(1&e){var t=C.Zb();C.Yb(0,"div",8),C.Yb(1,"button",9),C.gc("click",(function(){return C.zc(t),C.jc().onOpenModal()})),C.Tb(2,"i",10),C.Hc(3," New project "),C.Xb(),C.Xb()}}function G(e,n){if(1&e){var t=C.Zb();C.Yb(0,"laze-project-card",11),C.gc("projectAction",(function(e){C.zc(t);var r=n.$implicit;return C.jc().onProjectAction(e,r)})),C.Xb()}if(2&e){var r=n.$implicit,i=C.jc();C.qc("project",r)("currentUser",i.currentUser)}}function $(e,n){if(1&e&&C.Tb(0,"nz-alert",12),2&e){var t=C.jc();C.qc("nzDescription",t.errorMessage)}}function B(e,n){1&e&&C.Tb(0,"laze-project-form")}var K,Q,R=((Q=function(){function e(n,t,r,i,o){_classCallCheck(this,e),this.router=n,this.route=t,this.filestackService=r,this.projectsService=i,this.projectFormService=o,this.isModalVisible=this.isSaveLoading=!1}return _createClass(e,[{key:"ngOnInit",value:function(){this.currentUser=this.route.snapshot.data.currentUser,this.projects=this.route.snapshot.data.projects,this.onPageIndexChange(1),this.filestackService.init(w.a.filestackApiKey)}},{key:"onPageIndexChange",value:function(e){this.projectsToDisplay=this.projects.slice(10*(e-1),10*e)}},{key:"onOpenModal",value:function(){this.isModalVisible=!0}},{key:"onSaveProject",value:function(){var e=this;if(this.errorMessage=null,this.projectFormService.getFormValidity()){this.isSaveLoading=!0;var n=Object.assign(Object.assign({},this.projectFormService.getFormValue()),{status:"INITIATED",ownerId:this.currentUser.id}),t=this.projectsService.create(n);this.projectFormService.getFormValue().file&&(t=this.filestackService.upload(this.projectFormService.getFormValue().file).pipe(Object(k.a)((function(t){return n.fileUrl=t.url,e.projectsService.create(n)})))),t.pipe(Object(S.a)((function(n){console.log({project:n}),e.isSaveLoading=!1})),Object(P.a)(500),Object(S.a)((function(n){return e.onCancel()})),Object(Y.a)((function(n){return e.errorMessage=n.message,e.isSaveLoading=!1,n}))).subscribe()}}},{key:"onCancel",value:function(){this.isModalVisible=!1}},{key:"onProjectAction",value:function(e,n){this.router.navigate(["/main","project",n.id])}},{key:"isCurrentUserAdmin",get:function(){var e;return"ADMIN"===(null===(e=this.currentUser)||void 0===e?void 0:e.role)}}]),e}()).\u0275fac=function(e){return new(e||Q)(C.Sb(o.f),C.Sb(o.a),C.Sb(y.b),C.Sb(O.a),C.Sb(T))},Q.\u0275cmp=C.Mb({type:Q,selectors:[["ng-component"]],decls:8,vars:8,consts:[["nzTitle","Projects","nzSubtitle","All available projects",1,"site-page-header"],["class","new-button-wrapper",4,"ngIf"],["nz-row","",1,"project-cards"],["nz-col","","nzXs","24","nzSm","24","nzMd","11","nzLg","11","nzXl","11",3,"project","currentUser","projectAction",4,"ngFor","ngForOf"],[3,"nzPageIndex","nzTotal","nzPageIndexChange"],["nzTitle","Create new project",3,"nzVisible","nzOkLoading","nzVisibleChange","nzOnCancel","nzOnOk"],["class","auth-form-margin","nzType","error","nzCloseable","","nzMessage","Project creation error",3,"nzDescription",4,"ngIf"],[4,"ngIf"],[1,"new-button-wrapper"],["nz-button","","nzType","primary",3,"click"],["nz-icon","","nzType","plus"],["nz-col","","nzXs","24","nzSm","24","nzMd","11","nzLg","11","nzXl","11",3,"project","currentUser","projectAction"],["nzType","error","nzCloseable","","nzMessage","Project creation error",1,"auth-form-margin",3,"nzDescription"]],template:function(e,n){1&e&&(C.Tb(0,"nz-page-header",0),C.Fc(1,Z,4,0,"div",1),C.Yb(2,"div",2),C.Fc(3,G,1,2,"laze-project-card",3),C.Xb(),C.Yb(4,"nz-pagination",4),C.gc("nzPageIndexChange",(function(e){return n.onPageIndexChange(e)})),C.Xb(),C.Yb(5,"nz-modal",5),C.gc("nzVisibleChange",(function(e){return n.isModalVisible=e}))("nzOnCancel",(function(){return n.onCancel()}))("nzOnOk",(function(){return n.onSaveProject()})),C.Fc(6,$,1,1,"nz-alert",6),C.Fc(7,B,1,0,"laze-project-form",7),C.Xb()),2&e&&(C.Cb(1),C.qc("ngIf",!n.isCurrentUserAdmin),C.Cb(2),C.qc("ngForOf",n.projectsToDisplay),C.Cb(1),C.qc("nzPageIndex",1)("nzTotal",n.projects.length),C.Cb(1),C.qc("nzVisible",n.isModalVisible)("nzOkLoading",n.isSaveLoading),C.Cb(1),C.qc("ngIf",n.errorMessage),C.Cb(1),C.qc("ngIf",n.isModalVisible))},directives:[l.a,i.m,I.c,i.l,v.a,b.a,s.a,V.a,M.a,a.a,A,I.a,z.a,W],styles:["nz-page-header[_ngcontent-%COMP%]{margin-bottom:24px}.new-button-wrapper[_ngcontent-%COMP%]{display:flex;justify-content:flex-start;margin-bottom:42px}.project-cards[_ngcontent-%COMP%]{justify-content:center;padding:0 12px}.project-cards[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{margin-bottom:24px}nz-pagination[_ngcontent-%COMP%]{text-align:center}@media (min-width:768px){.project-cards[_ngcontent-%COMP%]{justify-content:space-between}}"]}),Q),ee=((K=function e(){_classCallCheck(this,e)}).\u0275mod=C.Qb({type:K}),K.\u0275inj=C.Pb({factory:function(e){return new(e||K)},providers:[T],imports:[[i.c,o.i.forChild([{path:"",component:R,resolve:{projects:F.a,currentUser:X.a}}]),c.h,c.n,a.b,l.b,s.c,b.b,p.b,u.e,f.b,d.d,z.b,g.b,m.b,h.b,j.a,v.b,y.a]]}),K)}}]);