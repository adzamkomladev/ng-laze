(window.webpackJsonp=window.webpackJsonp||[]).push([[23],{DwnV:function(e,t,n){"use strict";n.r(t),n.d(t,"ProjectsModule",(function(){return $}));var r=n("ofXK"),i=n("tyNb"),o=n("3Pt+"),c=n("FwiY"),a=n("jPNr"),s=n("OzZK"),l=n("dEAy"),b=n("ocnv"),p=n("0lU3"),u=n("D9mS"),d=n("PTRe"),z=n("Wfee"),f=n("JA5x"),g=n("ZyQt"),m=n("ZE2D"),h=n("nJia"),j=n("3/1E"),v=n("jV0o"),C=n("fXoL");let y=(()=>{class e{setFormValue(e){var t;this.formValue=Object.assign(Object.assign({},e),{file:null===(t=this.formValue)||void 0===t?void 0:t.file})}addFile(e){this.formValue.file=e}getFormValue(){return Object.assign({},this.formValue)}setFormValidity(e){this.formValidity=e}getFormValidity(){return this.formValidity}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=C.Ob({token:e,factory:e.\u0275fac}),e})();var T=n("ML9l"),F=n("TzFQ"),X=n("bOdf"),S=n("vkgz"),Y=n("3E0/"),P=n("JIr8"),O=n("AytR"),w=n("Ihmt"),I=n("B+r4"),V=n("RwU8"),M=n("C2AL");function q(e,t){if(1&e){const e=C.Zb();C.Yb(0,"button",13),C.gc("click",(function(){return C.zc(e),C.jc().onProjectAction("EDIT")})),C.Tb(1,"i",14),C.Hc(2,"Edit "),C.Xb()}}let x=(()=>{class e{constructor(){this.projectAction=new C.n}get canEdit(){var e;return this.project.ownerId===this.currentUser.id||(null===(e=this.project)||void 0===e?void 0:e.assigneeId)===this.currentUser.id||"ADMIN"===this.currentUser.role}onProjectAction(e){this.projectAction.emit(e)}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=C.Mb({type:e,selectors:[["laze-project-card"]],inputs:{project:"project",currentUser:"currentUser"},outputs:{projectAction:"projectAction"},decls:32,vars:14,consts:[["nz-row","","nzJustify","space-between"],["nz-col",""],["nzTooltipTitle","Project deadline","nzTooltipPlacement","bottom","nz-tooltip",""],["nz-icon","","nzType","hourglass","nzTheme","outline"],["nzTooltipTitle","Project creation","nzTooltipPlacement","bottom","nz-tooltip",""],["nz-icon","","nzType","calendar"],["typography","",1,"price"],[1,"owner-info"],["nzText","U",3,"nzSrc"],["nzColor","#337357"],["nz-button","","nzType","primary",3,"click"],["nz-icon","","nzType","eye"],["nz-button","","nzType","default",3,"click",4,"ngIf"],["nz-button","","nzType","default",3,"click"],["nz-icon","","nzType","edit"]],template:function(e,t){1&e&&(C.Yb(0,"nz-card"),C.Yb(1,"div",0),C.Yb(2,"div",1),C.Yb(3,"h3"),C.Hc(4),C.Xb(),C.Yb(5,"p",2),C.Tb(6,"i",3),C.Hc(7),C.kc(8,"date"),C.Xb(),C.Yb(9,"p",4),C.Tb(10,"i",5),C.Hc(11),C.kc(12,"date"),C.Xb(),C.Xb(),C.Yb(13,"div",1),C.Yb(14,"p",6),C.Yb(15,"strong"),C.Hc(16),C.Xb(),C.Xb(),C.Yb(17,"div",7),C.Tb(18,"nz-avatar",8),C.Yb(19,"p"),C.Hc(20),C.Xb(),C.Xb(),C.Xb(),C.Xb(),C.Tb(21,"hr"),C.Yb(22,"div",0),C.Yb(23,"div",1),C.Yb(24,"nz-tag",9),C.Hc(25),C.kc(26,"titlecase"),C.Xb(),C.Xb(),C.Yb(27,"div",1),C.Yb(28,"button",10),C.gc("click",(function(){return t.onProjectAction("VIEW")})),C.Tb(29,"i",11),C.Hc(30,"View "),C.Xb(),C.Fc(31,q,3,0,"button",12),C.Xb(),C.Xb(),C.Xb()),2&e&&(C.Cb(4),C.Ic(t.project.title),C.Cb(3),C.Jc(" ",C.lc(8,8,t.project.deadline)," "),C.Cb(4),C.Jc(" ",C.lc(12,10,null==t.project?null:t.project.createdAt)," "),C.Cb(5),C.Ic((null==t.project?null:t.project.price)||"N/A"),C.Cb(2),C.qc("nzSrc",null==t.project.owner?null:t.project.owner.profileImageUrl),C.Cb(2),C.Ic(t.project.owner.username),C.Cb(5),C.Ic(C.lc(26,12,t.project.status)),C.Cb(6),C.qc("ngIf",t.canEdit))},directives:[f.a,I.c,I.a,h.b,c.a,M.a,m.a,g.a,s.a,V.a,r.m],pipes:[r.e,r.v],styles:["nz-card[_ngcontent-%COMP%]{box-shadow:0 2px 2px #bababa}.price[_ngcontent-%COMP%]{text-align:right}.owner-info[_ngcontent-%COMP%]{text-align:left}button[_ngcontent-%COMP%]{margin-right:12px}"]}),e})();function k(e,t){1&e&&(C.Wb(0),C.Hc(1," Please input project title! "),C.Vb())}function A(e,t){1&e&&(C.Wb(0),C.Hc(1," Project title must be less than 255 characters! "),C.Vb())}function L(e,t){if(1&e&&(C.Fc(0,k,2,0,"ng-container",17),C.Fc(1,A,2,0,"ng-container",17)),2&e){const e=t.$implicit;C.qc("ngIf",e.hasError("required")),C.Cb(1),C.qc("ngIf",e.hasError("maxlength"))}}function U(e,t){1&e&&(C.Wb(0),C.Hc(1," Please input project details! "),C.Vb())}function E(e,t){1&e&&C.Fc(0,U,2,0,"ng-container",17),2&e&&C.qc("ngIf",t.$implicit.hasError("required"))}function H(e,t){1&e&&(C.Wb(0),C.Hc(1," Please input your deadline! "),C.Vb())}function D(e,t){1&e&&C.Fc(0,H,2,0,"ng-container",17),2&e&&C.qc("ngIf",t.$implicit.hasError("required"))}let _=(()=>{class e{constructor(e,t){this.fb=e,this.projectFormService=t,this.beforeUpload=e=>(this.fileList=this.fileList.concat(e),this.projectFormService.addFile(e),!1),this.fileList=[]}ngOnInit(){this.initializeForm(),this.setupFormListener()}ngOnDestroy(){this.valueChangesSubscription&&this.valueChangesSubscription.unsubscribe()}initializeForm(){this.form=this.fb.group({title:[null,[o.o.required,o.o.maxLength(255)]],details:[null,[o.o.required]],deadline:[null,[o.o.required]]},{updateOn:"blur"})}setupFormListener(){this.valueChangesSubscription=this.form.valueChanges.pipe(Object(S.a)(e=>{this.projectFormService.setFormValue(e),this.projectFormService.setFormValidity(this.form.valid)})).subscribe()}}return e.\u0275fac=function(t){return new(t||e)(C.Sb(o.d),C.Sb(y))},e.\u0275cmp=C.Mb({type:e,selectors:[["laze-project-form"]],decls:35,vars:10,consts:[["nz-form","",1,"auth-form",3,"formGroup"],["nzFor","title","nz-typography","",3,"nzSpan"],["nzHasFeedback","","nzValidatingTip","Validating...",3,"nzErrorTip"],["id","title","type","text","nz-input","","nzSize","large","formControlName","title","placeholder","Project title"],["titleErrorTemplate",""],["nzFor","details","nz-typography","",3,"nzSpan"],["id","details","nz-input","","rows","4","formControlName","details","placeholder","Project details"],["detailsErrorTemplate",""],["nz-row","","nzType","flex","nzJustify","space-between"],["nz-col","","nzXs","24","nzSm","24","nzMd","11","nzLg","11","nzXl","11"],["nzFor","deadline","nz-typography","",3,"nzSpan"],["id","deadline","formControlName","deadline"],["deadlineErrorTemplate",""],["nzFor","file","nz-typography","",3,"nzSpan"],[3,"nzFileList","nzBeforeUpload","nzFileListChange"],["nz-button",""],["nz-icon","","nzType","upload"],[4,"ngIf"]],template:function(e,t){if(1&e&&(C.Yb(0,"form",0),C.Yb(1,"nz-form-item"),C.Yb(2,"nz-form-label",1),C.Yb(3,"strong"),C.Hc(4,"Title"),C.Xb(),C.Xb(),C.Yb(5,"nz-form-control",2),C.Tb(6,"input",3),C.Fc(7,L,2,2,"ng-template",null,4,C.Gc),C.Xb(),C.Xb(),C.Yb(9,"nz-form-item"),C.Yb(10,"nz-form-label",5),C.Yb(11,"strong"),C.Hc(12,"Details"),C.Xb(),C.Xb(),C.Yb(13,"nz-form-control",2),C.Tb(14,"textarea",6),C.Fc(15,E,1,1,"ng-template",null,7,C.Gc),C.Xb(),C.Xb(),C.Yb(17,"div",8),C.Yb(18,"nz-form-item",9),C.Yb(19,"nz-form-label",10),C.Yb(20,"strong"),C.Hc(21,"Deadline"),C.Xb(),C.Xb(),C.Yb(22,"nz-form-control",2),C.Tb(23,"nz-date-picker",11),C.Fc(24,D,1,1,"ng-template",null,12,C.Gc),C.Xb(),C.Xb(),C.Yb(26,"nz-form-item",9),C.Yb(27,"nz-form-label",13),C.Yb(28,"strong"),C.Hc(29,"File"),C.Xb(),C.Xb(),C.Yb(30,"nz-form-control"),C.Yb(31,"nz-upload",14),C.gc("nzFileListChange",(function(e){return t.fileList=e})),C.Yb(32,"button",15),C.Tb(33,"i",16),C.Hc(34,"Select File"),C.Xb(),C.Xb(),C.Xb(),C.Xb(),C.Xb(),C.Xb()),2&e){const e=C.yc(8),n=C.yc(16),r=C.yc(25);C.qc("formGroup",t.form),C.Cb(2),C.qc("nzSpan",24),C.Cb(3),C.qc("nzErrorTip",e),C.Cb(5),C.qc("nzSpan",24),C.Cb(3),C.qc("nzErrorTip",n),C.Cb(6),C.qc("nzSpan",24),C.Cb(3),C.qc("nzErrorTip",r),C.Cb(5),C.qc("nzSpan",24),C.Cb(4),C.qc("nzFileList",t.fileList)("nzBeforeUpload",t.beforeUpload)}},directives:[o.p,o.l,b.b,o.g,I.c,b.c,I.a,b.d,b.a,d.a,o.c,o.k,o.f,p.a,u.a,s.a,V.a,M.a,c.a,r.m],styles:[""]}),e})();function N(e,t){if(1&e){const e=C.Zb();C.Yb(0,"div",8),C.Yb(1,"button",9),C.gc("click",(function(){return C.zc(e),C.jc().onOpenModal()})),C.Tb(2,"i",10),C.Hc(3," New project "),C.Xb(),C.Xb()}}function J(e,t){if(1&e){const e=C.Zb();C.Yb(0,"laze-project-card",11),C.gc("projectAction",(function(n){C.zc(e);const r=t.$implicit;return C.jc().onProjectAction(n,r)})),C.Xb()}if(2&e){const e=t.$implicit,n=C.jc();C.qc("project",e)("currentUser",n.currentUser)}}function W(e,t){if(1&e&&C.Tb(0,"nz-alert",12),2&e){const e=C.jc();C.qc("nzDescription",e.errorMessage)}}function Z(e,t){1&e&&C.Tb(0,"laze-project-form")}let G=(()=>{class e{constructor(e,t,n,r,i){this.router=e,this.route=t,this.filestackService=n,this.projectsService=r,this.projectFormService=i,this.isModalVisible=this.isSaveLoading=!1}get isCurrentUserAdmin(){var e;return"ADMIN"===(null===(e=this.currentUser)||void 0===e?void 0:e.role)}ngOnInit(){this.currentUser=this.route.snapshot.data.currentUser,this.projects=this.route.snapshot.data.projects,this.onPageIndexChange(1),this.filestackService.init(O.a.filestackApiKey)}onPageIndexChange(e){this.projectsToDisplay=this.projects.slice(10*(e-1),10*e)}onOpenModal(){this.isModalVisible=!0}onSaveProject(){if(this.errorMessage=null,!this.projectFormService.getFormValidity())return;this.isSaveLoading=!0;const e=Object.assign(Object.assign({},this.projectFormService.getFormValue()),{status:"INITIATED",ownerId:this.currentUser.id});let t=this.projectsService.create(e);this.projectFormService.getFormValue().file&&(t=this.filestackService.upload(this.projectFormService.getFormValue().file).pipe(Object(X.a)(t=>(e.fileUrl=t.url,this.projectsService.create(e))))),t.pipe(Object(S.a)(e=>{console.log({project:e}),this.isSaveLoading=!1}),Object(Y.a)(500),Object(S.a)(e=>this.onCancel()),Object(P.a)(e=>(this.errorMessage=e.message,this.isSaveLoading=!1,e))).subscribe()}onCancel(){this.isModalVisible=!1}onProjectAction(e,t){this.router.navigate(["/main","project",t.id])}}return e.\u0275fac=function(t){return new(t||e)(C.Sb(i.f),C.Sb(i.a),C.Sb(v.b),C.Sb(w.a),C.Sb(y))},e.\u0275cmp=C.Mb({type:e,selectors:[["ng-component"]],decls:8,vars:8,consts:[["nzTitle","Projects","nzSubtitle","All available projects",1,"site-page-header"],["class","new-button-wrapper",4,"ngIf"],["nz-row","",1,"project-cards"],["nz-col","","nzXs","24","nzSm","24","nzMd","11","nzLg","11","nzXl","11",3,"project","currentUser","projectAction",4,"ngFor","ngForOf"],[3,"nzPageIndex","nzTotal","nzPageIndexChange"],["nzTitle","Create new project",3,"nzVisible","nzOkLoading","nzVisibleChange","nzOnCancel","nzOnOk"],["class","auth-form-margin","nzType","error","nzCloseable","","nzMessage","Project creation error",3,"nzDescription",4,"ngIf"],[4,"ngIf"],[1,"new-button-wrapper"],["nz-button","","nzType","primary",3,"click"],["nz-icon","","nzType","plus"],["nz-col","","nzXs","24","nzSm","24","nzMd","11","nzLg","11","nzXl","11",3,"project","currentUser","projectAction"],["nzType","error","nzCloseable","","nzMessage","Project creation error",1,"auth-form-margin",3,"nzDescription"]],template:function(e,t){1&e&&(C.Tb(0,"nz-page-header",0),C.Fc(1,N,4,0,"div",1),C.Yb(2,"div",2),C.Fc(3,J,1,2,"laze-project-card",3),C.Xb(),C.Yb(4,"nz-pagination",4),C.gc("nzPageIndexChange",(function(e){return t.onPageIndexChange(e)})),C.Xb(),C.Yb(5,"nz-modal",5),C.gc("nzVisibleChange",(function(e){return t.isModalVisible=e}))("nzOnCancel",(function(){return t.onCancel()}))("nzOnOk",(function(){return t.onSaveProject()})),C.Fc(6,W,1,1,"nz-alert",6),C.Fc(7,Z,1,0,"laze-project-form",7),C.Xb()),2&e&&(C.Cb(1),C.qc("ngIf",!t.isCurrentUserAdmin),C.Cb(2),C.qc("ngForOf",t.projectsToDisplay),C.Cb(1),C.qc("nzPageIndex",1)("nzTotal",t.projects.length),C.Cb(1),C.qc("nzVisible",t.isModalVisible)("nzOkLoading",t.isSaveLoading),C.Cb(1),C.qc("ngIf",t.errorMessage),C.Cb(1),C.qc("ngIf",t.isModalVisible))},directives:[a.a,r.m,I.c,r.l,j.a,l.a,s.a,V.a,M.a,c.a,x,I.a,z.a,_],styles:["nz-page-header[_ngcontent-%COMP%]{margin-bottom:24px}.new-button-wrapper[_ngcontent-%COMP%]{display:flex;justify-content:flex-start;margin-bottom:42px}.project-cards[_ngcontent-%COMP%]{justify-content:center;padding:0 12px}.project-cards[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{margin-bottom:24px}nz-pagination[_ngcontent-%COMP%]{text-align:center}@media (min-width:768px){.project-cards[_ngcontent-%COMP%]{justify-content:space-between}}"]}),e})(),$=(()=>{class e{}return e.\u0275mod=C.Qb({type:e}),e.\u0275inj=C.Pb({factory:function(t){return new(t||e)},providers:[y],imports:[[r.c,i.i.forChild([{path:"",component:G,resolve:{projects:T.a,currentUser:F.a}}]),o.h,o.n,c.b,a.b,s.c,l.b,p.b,b.e,u.b,d.d,z.b,f.b,g.b,m.b,h.a,j.b,v.a]]}),e})()}}]);